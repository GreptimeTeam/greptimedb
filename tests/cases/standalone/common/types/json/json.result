CREATE TABLE jsons (j JSON, t timestamp time index);

Affected Rows: 0

--Insert valid json strings--
INSERT INTO jsons VALUES(to_json('{"a":1, "b":2, "c":3}'), 1), (to_json('{"a":1, "b":2, "c":3, "d":4}'), 2), (to_json('{"a":1, "b":2, "c":3, "d":4, "e":5}'), 3);

Affected Rows: 3

SELECT json_to_string(j), t FROM jsons;

+---------------------------------+-------------------------+
| json_to_string(jsons.j)         | t                       |
+---------------------------------+-------------------------+
| {"a":1,"b":2,"c":3}             | 1970-01-01T00:00:00.001 |
| {"a":1,"b":2,"c":3,"d":4}       | 1970-01-01T00:00:00.002 |
| {"a":1,"b":2,"c":3,"d":4,"e":5} | 1970-01-01T00:00:00.003 |
+---------------------------------+-------------------------+

--Insert invalid json strings--
DELETE FROM jsons;

Affected Rows: 3

INSERT INTO jsons VALUES(to_json('{"a":1, "b":2, "c":3'), 4);

Error: 3001(EngineExecuteQuery), DataFusion error: Invalid function args: Cannot convert the string to json, have: {"a":1, "b":2, "c":3

INSERT INTO jsons VALUES(to_json('Morning my friends, have a nice day :)'), 5);

Error: 3001(EngineExecuteQuery), DataFusion error: Invalid function args: Cannot convert the string to json, have: Morning my friends, have a nice day :)

SELECT json_to_string(j), t FROM jsons;

++
++

CREATE TABLE json_empty (j JSON, t timestamp time index);

Affected Rows: 0

INSERT INTO json_empty VALUES(NULL, 2);

Affected Rows: 1

SELECT json_to_string(j), t FROM json_empty;

+------------------------------+-------------------------+
| json_to_string(json_empty.j) | t                       |
+------------------------------+-------------------------+
|                              | 1970-01-01T00:00:00.002 |
+------------------------------+-------------------------+

drop table jsons;

Affected Rows: 0

drop table json_empty;

Affected Rows: 0


-- Test aggregation functions with decimal
-- Port from https://github.com/duckdb/duckdb/blob/main/test/sql/types/decimal/decimal_aggregates.test
SELECT arrow_typeof(FIRST_VALUE('0.1'::DECIMAL(4,1)));

+----------------------------------------+
| arrow_typeof(first_value(Utf8("0.1"))) |
+----------------------------------------+
| Decimal128(4, 1)                       |
+----------------------------------------+

-- first_value
SELECT FIRST_VALUE(NULL::DECIMAL),
    FIRST_VALUE('0.1'::DECIMAL(4,1))::VARCHAR,
    FIRST_VALUE('4938245.1'::DECIMAL(9,1))::VARCHAR,
    FIRST_VALUE('45672564564938245.1'::DECIMAL(18,1))::VARCHAR,
    FIRST_VALUE('4567645908450368043562342564564938245.1'::DECIMAL(38,1))::VARCHAR;

+-------------------+--------------------------+--------------------------------+------------------------------------------+--------------------------------------------------------------+
| first_value(NULL) | first_value(Utf8("0.1")) | first_value(Utf8("4938245.1")) | first_value(Utf8("45672564564938245.1")) | first_value(Utf8("4567645908450368043562342564564938245.1")) |
+-------------------+--------------------------+--------------------------------+------------------------------------------+--------------------------------------------------------------+
|                   | 0.1                      | 4938245.1                      | 45672564564938245.1                      | 4567645908450368043562342564564938245.1                      |
+-------------------+--------------------------+--------------------------------+------------------------------------------+--------------------------------------------------------------+

-- min
SELECT MIN(NULL::DECIMAL),
       MIN('0.1'::DECIMAL(4,1))::VARCHAR,
        MIN('4938245.1'::DECIMAL(9,1))::VARCHAR,
        MIN('45672564564938245.1'::DECIMAL(18,1))::VARCHAR,
        MIN('4567645908450368043562342564564938245.1'::DECIMAL(38,1))::VARCHAR;

+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
| min(NULL) | min(Utf8("0.1")) | min(Utf8("4938245.1")) | min(Utf8("45672564564938245.1")) | min(Utf8("4567645908450368043562342564564938245.1")) |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
|           | 0.1              | 4938245.1              | 45672564564938245.1              | 4567645908450368043562342564564938245.1              |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+

-- max
SELECT MAX(NULL::DECIMAL),
       MAX('0.1'::DECIMAL(4,1))::VARCHAR,
        MAX('4938245.1'::DECIMAL(9,1))::VARCHAR,
        MAX('45672564564938245.1'::DECIMAL(18,1))::VARCHAR,
        MAX('4567645908450368043562342564564938245.1'::DECIMAL(38,1))::VARCHAR;

+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
| max(NULL) | max(Utf8("0.1")) | max(Utf8("4938245.1")) | max(Utf8("45672564564938245.1")) | max(Utf8("4567645908450368043562342564564938245.1")) |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
|           | 0.1              | 4938245.1              | 45672564564938245.1              | 4567645908450368043562342564564938245.1              |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+

-- sum
SELECT SUM(NULL::DECIMAL),
       SUM('0.1'::DECIMAL(4,1))::VARCHAR,
        SUM('4938245.1'::DECIMAL(9,1))::VARCHAR,
        SUM('45672564564938245.1'::DECIMAL(18,1))::VARCHAR,
        SUM('4567645908450368043562342564564938245.1'::DECIMAL(38,1))::VARCHAR;

+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
| sum(NULL) | sum(Utf8("0.1")) | sum(Utf8("4938245.1")) | sum(Utf8("45672564564938245.1")) | sum(Utf8("4567645908450368043562342564564938245.1")) |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+
|           | 0.1              | 4938245.1              | 45672564564938245.1              | 4567645908450368043562342564564938245.1              |
+-----------+------------------+------------------------+----------------------------------+------------------------------------------------------+

-- decimal aggregates over a table
CREATE TABLE decimals (
    d1 DECIMAL(4,1),
    d2 DECIMAL(9,1),
    d3 DECIMAL(18,1),
    d4 DECIMAL(38,1),
    ts timestamp time index,
);

Affected Rows: 0

INSERT INTO decimals values
(123,123*123,123*123*123,123*123*123*123,1000),
(456,456*456,456*456*456,456*456*456*456,2000),
(789,789*789,789*789*789,789*789*789*789,3000);

Affected Rows: 3

SELECT SUM(d1)::VARCHAR, SUM(d2)::VARCHAR, SUM(d3)::VARCHAR, SUM(d4)::VARCHAR FROM decimals;

+------------------+------------------+------------------+------------------+
| sum(decimals.d1) | sum(decimals.d2) | sum(decimals.d3) | sum(decimals.d4) |
+------------------+------------------+------------------+------------------+
| 1368.0           | 845586.0         | 587848752.0      | 430998662178.0   |
+------------------+------------------+------------------+------------------+

INSERT INTO decimals VALUES ('0.1', '0.1', '0.1', '0.1', 4000), ('0.2', '0.2', '0.2', '0.2', 5000);

Affected Rows: 2

SELECT SUM(d1)::VARCHAR, SUM(d2)::VARCHAR, SUM(d3)::VARCHAR, SUM(d4)::VARCHAR FROM decimals;

+------------------+------------------+------------------+------------------+
| sum(decimals.d1) | sum(decimals.d2) | sum(decimals.d3) | sum(decimals.d4) |
+------------------+------------------+------------------+------------------+
| 1368.3           | 845586.3         | 587848752.3      | 430998662178.3   |
+------------------+------------------+------------------+------------------+

DROP TABLE decimals;

Affected Rows: 0


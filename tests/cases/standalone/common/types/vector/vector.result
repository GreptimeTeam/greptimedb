CREATE TABLE t (ts TIMESTAMP TIME INDEX, v VECTOR(3));

Affected Rows: 0

-- Invert string
INSERT INTO t VALUES
(1, '[1.0, 2.0, 3.0]'),
(2, '[4.0, 5.0, 6.0]'),
(3, '[7.0, 8.0, 9.0]');

Affected Rows: 3

-- Invert vector value
INSERT INTO t VALUES
(4, parse_vec('[1.0, 2.0, 3.0]')),
(5, parse_vec('[4.0, 5.0, 6.0]')),
(6, parse_vec('[7.0, 8.0, 9.0]'));

Affected Rows: 3

SELECT ts, v, vec_to_string(v) FROM t;

+-------------------------+--------------------------+--------------------+
| ts                      | v                        | vec_to_string(t.v) |
+-------------------------+--------------------------+--------------------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            |
+-------------------------+--------------------------+--------------------+

SELECT round(vec_cos_distance(v, '[0.0, 0.0, 0.0]'), 2) FROM t;

+---------------------------------------------------------------+
| round(vec_cos_distance(t.v,Utf8("[0.0, 0.0, 0.0]")),Int64(2)) |
+---------------------------------------------------------------+
| 1.0                                                           |
| 1.0                                                           |
| 1.0                                                           |
| 1.0                                                           |
| 1.0                                                           |
| 1.0                                                           |
+---------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_cos_distance(v, '[0.0, 0.0, 0.0]'), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+-----+
| ts                      | v                        | vec_to_string(t.v) | d   |
+-------------------------+--------------------------+--------------------+-----+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 1.0 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 1.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 1.0 |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 1.0 |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 1.0 |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 1.0 |
+-------------------------+--------------------------+--------------------+-----+

SELECT round(vec_cos_distance('[7.0, 8.0, 9.0]', v), 2) FROM t;

+---------------------------------------------------------------+
| round(vec_cos_distance(Utf8("[7.0, 8.0, 9.0]"),t.v),Int64(2)) |
+---------------------------------------------------------------+
| 0.04                                                          |
| 0.0                                                           |
| 0.0                                                           |
| 0.04                                                          |
| 0.0                                                           |
| 0.0                                                           |
+---------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_cos_distance('[7.0, 8.0, 9.0]', v), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+------+
| ts                      | v                        | vec_to_string(t.v) | d    |
+-------------------------+--------------------------+--------------------+------+
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 0.0  |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 0.0  |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 0.0  |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 0.0  |
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 0.04 |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 0.04 |
+-------------------------+--------------------------+--------------------+------+

SELECT round(vec_cos_distance(v, v), 2) FROM t;

+-------------------------------------------+
| round(vec_cos_distance(t.v,t.v),Int64(2)) |
+-------------------------------------------+
| 0.0                                       |
| 0.0                                       |
| 0.0                                       |
| 0.0                                       |
| 0.0                                       |
| 0.0                                       |
+-------------------------------------------+

-- Unexpected dimension --
SELECT vec_cos_distance(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

-- Invalid type --
SELECT vec_cos_distance(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

SELECT round(vec_l2sq_distance(v, '[0.0, 0.0, 0.0]'), 2) FROM t;

+----------------------------------------------------------------+
| round(vec_l2sq_distance(t.v,Utf8("[0.0, 0.0, 0.0]")),Int64(2)) |
+----------------------------------------------------------------+
| 14.0                                                           |
| 77.0                                                           |
| 194.0                                                          |
| 14.0                                                           |
| 77.0                                                           |
| 194.0                                                          |
+----------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_l2sq_distance(v, '[0.0, 0.0, 0.0]'), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+-------+
| ts                      | v                        | vec_to_string(t.v) | d     |
+-------------------------+--------------------------+--------------------+-------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 14.0  |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 14.0  |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 77.0  |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 77.0  |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 194.0 |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 194.0 |
+-------------------------+--------------------------+--------------------+-------+

SELECT round(vec_l2sq_distance('[7.0, 8.0, 9.0]', v), 2) FROM t;

+----------------------------------------------------------------+
| round(vec_l2sq_distance(Utf8("[7.0, 8.0, 9.0]"),t.v),Int64(2)) |
+----------------------------------------------------------------+
| 108.0                                                          |
| 27.0                                                           |
| 0.0                                                            |
| 108.0                                                          |
| 27.0                                                           |
| 0.0                                                            |
+----------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_l2sq_distance('[7.0, 8.0, 9.0]', v), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+-------+
| ts                      | v                        | vec_to_string(t.v) | d     |
+-------------------------+--------------------------+--------------------+-------+
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 0.0   |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 0.0   |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 27.0  |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 27.0  |
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 108.0 |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 108.0 |
+-------------------------+--------------------------+--------------------+-------+

SELECT round(vec_l2sq_distance(v, v), 2) FROM t;

+--------------------------------------------+
| round(vec_l2sq_distance(t.v,t.v),Int64(2)) |
+--------------------------------------------+
| 0.0                                        |
| 0.0                                        |
| 0.0                                        |
| 0.0                                        |
| 0.0                                        |
| 0.0                                        |
+--------------------------------------------+

-- Unexpected dimension --
SELECT vec_l2sq_distance(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

-- Invalid type --
SELECT vec_l2sq_distance(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

SELECT round(vec_dot_product(v, '[0.0, 0.0, 0.0]'), 2) FROM t;

+--------------------------------------------------------------+
| round(vec_dot_product(t.v,Utf8("[0.0, 0.0, 0.0]")),Int64(2)) |
+--------------------------------------------------------------+
| 0.0                                                          |
| 0.0                                                          |
| 0.0                                                          |
| 0.0                                                          |
| 0.0                                                          |
| 0.0                                                          |
+--------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_dot_product(v, '[0.0, 0.0, 0.0]'), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+-----+
| ts                      | v                        | vec_to_string(t.v) | d   |
+-------------------------+--------------------------+--------------------+-----+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 0.0 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 0.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 0.0 |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 0.0 |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 0.0 |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 0.0 |
+-------------------------+--------------------------+--------------------+-----+

SELECT round(vec_dot_product('[7.0, 8.0, 9.0]', v), 2) FROM t;

+--------------------------------------------------------------+
| round(vec_dot_product(Utf8("[7.0, 8.0, 9.0]"),t.v),Int64(2)) |
+--------------------------------------------------------------+
| 50.0                                                         |
| 122.0                                                        |
| 194.0                                                        |
| 50.0                                                         |
| 122.0                                                        |
| 194.0                                                        |
+--------------------------------------------------------------+

SELECT ts, v, vec_to_string(v), round(vec_dot_product('[7.0, 8.0, 9.0]', v), 2) as d FROM t ORDER BY d, ts;

+-------------------------+--------------------------+--------------------+-------+
| ts                      | v                        | vec_to_string(t.v) | d     |
+-------------------------+--------------------------+--------------------+-------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]            | 50.0  |
| 1970-01-01T00:00:00.004 | 0000803f0000004000004040 | [1,2,3]            | 50.0  |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | [4,5,6]            | 122.0 |
| 1970-01-01T00:00:00.005 | 000080400000a0400000c040 | [4,5,6]            | 122.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | [7,8,9]            | 194.0 |
| 1970-01-01T00:00:00.006 | 0000e0400000004100001041 | [7,8,9]            | 194.0 |
+-------------------------+--------------------------+--------------------+-------+

SELECT round(vec_dot_product(v, v), 2) FROM t;

+------------------------------------------+
| round(vec_dot_product(t.v,t.v),Int64(2)) |
+------------------------------------------+
| 14.0                                     |
| 77.0                                     |
| 194.0                                    |
| 14.0                                     |
| 77.0                                     |
| 194.0                                    |
+------------------------------------------+

-- Unexpected dimension --
SELECT vec_dot_product(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

-- Invalid type --
SELECT vec_dot_product(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

-- Unexpected dimension --
INSERT INTO t VALUES
(4, '[1.0]');

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse [1.0] to Vector value: wrong dimension

-- Invalid vector value --
INSERT INTO t VALUES
(5, '1.0,2.0,3.0');

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse 1.0,2.0,3.0 to Vector value: not properly enclosed in brackets

-- Invalid vector value --
INSERT INTO t VALUES
(6, '[30h, 40s, 50m]');

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse [30h, 40s, 50m] to Vector value: elements are not all float32

CREATE TABLE t2 (ts TIMESTAMP TIME INDEX, v VECTOR(3) DEFAULT '[1.0, 2.0, 3.0]');

Affected Rows: 0

INSERT INTO t2 (ts) VALUES
(1),
(2),
(3);

Affected Rows: 3

SELECT ts, v, vec_to_string(v) FROM t2;

+-------------------------+--------------------------+---------------------+
| ts                      | v                        | vec_to_string(t2.v) |
+-------------------------+--------------------------+---------------------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | [1,2,3]             |
| 1970-01-01T00:00:00.002 | 0000803f0000004000004040 | [1,2,3]             |
| 1970-01-01T00:00:00.003 | 0000803f0000004000004040 | [1,2,3]             |
+-------------------------+--------------------------+---------------------+

DROP TABLE t;

Affected Rows: 0

DROP TABLE t2;

Affected Rows: 0


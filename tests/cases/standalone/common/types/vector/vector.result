CREATE TABLE t (ts TIMESTAMP TIME INDEX, v VECTOR(3));

Affected Rows: 0

INSERT INTO t VALUES
(1, "[1.0, 2.0, 3.0]"),
(2, "[4.0, 5.0, 6.0]"),
(3, "[7.0, 8.0, 9.0]");

Affected Rows: 3

-- SQLNESS PROTOCOL MYSQL
SELECT * FROM t;

+----------------------------+---------+
| ts                         | v       |
+----------------------------+---------+
| 1970-01-01 00:00:00.001000 | [1,2,3] |
| 1970-01-01 00:00:00.002000 | [4,5,6] |
| 1970-01-01 00:00:00.003000 | [7,8,9] |
+----------------------------+---------+

-- SQLNESS PROTOCOL POSTGRES
SELECT * FROM t;

+----------------------------+-----------+
| ts                         | v         |
+----------------------------+-----------+
| 1970-01-01 00:00:00.001000 | "[1,2,3]" |
| 1970-01-01 00:00:00.002000 | "[4,5,6]" |
| 1970-01-01 00:00:00.003000 | "[7,8,9]" |
+----------------------------+-----------+

SELECT cos_distance(v, '[0.0, 0.0, 0.0]') FROM t;

+-------------------------------------------+
| cos_distance(t.v,Utf8("[0.0, 0.0, 0.0]")) |
+-------------------------------------------+
| 1.0                                       |
| 1.0                                       |
| 1.0                                       |
+-------------------------------------------+

SELECT *, cos_distance(v, '[0.0, 0.0, 0.0]') as d FROM t ORDER BY d;

+-------------------------+--------------------------+-----+
| ts                      | v                        | d   |
+-------------------------+--------------------------+-----+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 1.0 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 1.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 1.0 |
+-------------------------+--------------------------+-----+

SELECT cos_distance('[1.0, 2.0, 3.0]', v) FROM t;

+-------------------------------------------+
| cos_distance(Utf8("[1.0, 2.0, 3.0]"),t.v) |
+-------------------------------------------+
| 5.9604645e-8                              |
| 0.025368154                               |
| 0.04058808                                |
+-------------------------------------------+

SELECT *, cos_distance('[1.0, 2.0, 3.0]', v) as d FROM t ORDER BY d;

+-------------------------+--------------------------+--------------+
| ts                      | v                        | d            |
+-------------------------+--------------------------+--------------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 5.9604645e-8 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 0.025368154  |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 0.04058808   |
+-------------------------+--------------------------+--------------+

SELECT cos_distance(v, v) FROM t;

+-----------------------+
| cos_distance(t.v,t.v) |
+-----------------------+
| 5.9604645e-8          |
| 0.0                   |
| 5.9604645e-8          |
+-----------------------+

SELECT cos_distance(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

SELECT cos_distance(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

SELECT l2sq_distance(v, '[0.0, 0.0, 0.0]') FROM t;

+--------------------------------------------+
| l2sq_distance(t.v,Utf8("[0.0, 0.0, 0.0]")) |
+--------------------------------------------+
| 14.0                                       |
| 77.0                                       |
| 194.0                                      |
+--------------------------------------------+

SELECT *, l2sq_distance(v, '[0.0, 0.0, 0.0]') as d FROM t ORDER BY d;

+-------------------------+--------------------------+-------+
| ts                      | v                        | d     |
+-------------------------+--------------------------+-------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 14.0  |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 77.0  |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 194.0 |
+-------------------------+--------------------------+-------+

SELECT l2sq_distance('[1.0, 2.0, 3.0]', v) FROM t;

+--------------------------------------------+
| l2sq_distance(Utf8("[1.0, 2.0, 3.0]"),t.v) |
+--------------------------------------------+
| 0.0                                        |
| 27.0                                       |
| 108.0                                      |
+--------------------------------------------+

SELECT *, l2sq_distance('[1.0, 2.0, 3.0]', v) as d FROM t ORDER BY d;

+-------------------------+--------------------------+-------+
| ts                      | v                        | d     |
+-------------------------+--------------------------+-------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 0.0   |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 27.0  |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 108.0 |
+-------------------------+--------------------------+-------+

SELECT l2sq_distance(v, v) FROM t;

+------------------------+
| l2sq_distance(t.v,t.v) |
+------------------------+
| 0.0                    |
| 0.0                    |
| 0.0                    |
+------------------------+

SELECT l2sq_distance(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

SELECT l2sq_distance(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

SELECT dot_product(v, '[0.0, 0.0, 0.0]') FROM t;

+-------------------------------------------+
| dot_product(t.v,Utf8("[0.0, 0.0, 0.0]")) |
+-------------------------------------------+
| 0.0                                       |
| 0.0                                       |
| 0.0                                       |
+-------------------------------------------+

SELECT *, dot_product(v, '[0.0, 0.0, 0.0]') as d FROM t ORDER BY d;

+-------------------------+--------------------------+-----+
| ts                      | v                        | d   |
+-------------------------+--------------------------+-----+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 0.0 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 0.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 0.0 |
+-------------------------+--------------------------+-----+

SELECT dot_product('[1.0, 2.0, 3.0]', v) FROM t;

+-------------------------------------------+
| dot_product(Utf8("[1.0, 2.0, 3.0]"),t.v) |
+-------------------------------------------+
| 14.0                                      |
| 32.0                                      |
| 50.0                                      |
+-------------------------------------------+

SELECT *, dot_product('[1.0, 2.0, 3.0]', v) as d FROM t ORDER BY d;

+-------------------------+--------------------------+------+
| ts                      | v                        | d    |
+-------------------------+--------------------------+------+
| 1970-01-01T00:00:00.001 | 0000803f0000004000004040 | 14.0 |
| 1970-01-01T00:00:00.002 | 000080400000a0400000c040 | 32.0 |
| 1970-01-01T00:00:00.003 | 0000e0400000004100001041 | 50.0 |
+-------------------------+--------------------------+------+

SELECT dot_product(v, v) FROM t;

+-----------------------+
| dot_product(t.v,t.v) |
+-----------------------+
| 14.0                  |
| 77.0                  |
| 194.0                 |
+-----------------------+

SELECT dot_product(v, '[1.0]') FROM t;

Error: 3001(EngineExecuteQuery), Invalid function args: The length of the vectors must match to calculate distance, have: 3 vs 1

SELECT dot_product(v, 1.0) FROM t;

Error: 3001(EngineExecuteQuery), Invalid argument error: Encountered non UTF-8 data: invalid utf-8 sequence of 1 bytes from index 2

-- Unexpected dimension --
INSERT INTO t VALUES
(4, "[1.0]");

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse [1.0] to Vector value: wrong dimension

-- Invalid vector value --
INSERT INTO t VALUES
(5, "1.0,2.0,3.0");

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse 1.0,2.0,3.0 to Vector value: not properly enclosed in brackets

-- Invalid vector value --
INSERT INTO t VALUES
(6, "[30h, 40s, 50m]");

Error: 1004(InvalidArguments), Invalid Vector: Failed to parse [30h, 40s, 50m] to Vector value: elements are not all float32

CREATE TABLE t2 (ts TIMESTAMP TIME INDEX, v VECTOR(3) DEFAULT '[1.0, 2.0, 3.0]');

Affected Rows: 0

INSERT INTO t2 (ts) VALUES
(1),
(2),
(3);

Affected Rows: 3

-- SQLNESS PROTOCOL MYSQL
SELECT * FROM t2;

+----------------------------+---------+
| ts                         | v       |
+----------------------------+---------+
| 1970-01-01 00:00:00.001000 | [1,2,3] |
| 1970-01-01 00:00:00.002000 | [1,2,3] |
| 1970-01-01 00:00:00.003000 | [1,2,3] |
+----------------------------+---------+

-- SQLNESS PROTOCOL POSTGRES
SELECT * FROM t2;

+----------------------------+-----------+
| ts                         | v         |
+----------------------------+-----------+
| 1970-01-01 00:00:00.001000 | "[1,2,3]" |
| 1970-01-01 00:00:00.002000 | "[1,2,3]" |
| 1970-01-01 00:00:00.003000 | "[1,2,3]" |
+----------------------------+-----------+

DROP TABLE t;

Affected Rows: 0

DROP TABLE t2;

Affected Rows: 0


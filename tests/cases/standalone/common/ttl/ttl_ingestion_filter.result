-- Test TTL filtering at frontend during ingestion
CREATE TABLE ttl_frontend_test (
    `id` INT,
    `value` DOUBLE,
    `ts` TIMESTAMP TIME INDEX,
    PRIMARY KEY (`id`)
) WITH (
    ttl = '1h'
);

Affected Rows: 0

-- Try to insert data from 2 hours ago (should be filtered by frontend)
-- Using fixed old timestamp
INSERT INTO ttl_frontend_test VALUES
    (1, 1.0, '2020-01-01 10:00:00'),
    (2, 2.0, '2020-01-01 10:30:00');

Affected Rows: 0

-- Verify no rows were inserted (filtered at frontend)
SELECT COUNT(*) FROM ttl_frontend_test;

+----------+
| count(*) |
+----------+
| 0        |
+----------+

-- Insert recent data using now() (should succeed)
INSERT INTO ttl_frontend_test VALUES
    (3, 3.0, now());

Affected Rows: 1

-- Verify only recent data exists
SELECT COUNT(*) FROM ttl_frontend_test;

+----------+
| count(*) |
+----------+
| 1        |
+----------+

-- Test instant TTL (all data filtered immediately)
CREATE TABLE instant_ttl_test (
    `id` INT,
    `ts` TIMESTAMP TIME INDEX
) WITH (
    ttl = 'instant'
);

Affected Rows: 0

-- This should be filtered
INSERT INTO instant_ttl_test VALUES (1, now());

Affected Rows: 0

-- Verify nothing was stored
SELECT COUNT(*) FROM instant_ttl_test;

+----------+
| count(*) |
+----------+
| 0        |
+----------+

-- Cleanup
DROP TABLE ttl_frontend_test;

Affected Rows: 0

DROP TABLE instant_ttl_test;

Affected Rows: 0

